<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì²´í¬ë¦¬ìŠ¤íŠ¸ ì•± - Supabase ì „ìš©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- í”„ë¡œë•ì…˜ì—ì„œëŠ” ë‹¤ìš´ë¡œë“œí•œ Tailwind CSSë¥¼ ì‚¬ìš©í•˜ì„¸ìš” -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dark: {
                            bg: '#1a1a1a',
                            card: '#2d2d2d',
                            text: '#e5e5e5',
                            border: '#404040'
                        }
                    }
                }
            }
        }
    </script>
    <!-- Supabase í´ë¼ì´ì–¸íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable.min.css">
    <style>
        body {
            font-family: 'Pretendard Variable', -apple-system, BlinkMacSystemFont, system-ui, Roboto, 'Helvetica Neue', 'Segoe UI', 'Apple SD Gothic Neo', 'Noto Sans KR', 'Malgun Gothic', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }
        .status-btn {
            min-width: 40px;
            min-height: 80px;
            transition: all 0.2s ease;
            font-weight: 600;
            font-size: 0.9rem;
        }
        .icon-btn {
            @apply p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors;
        }
        .main-title {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
        }
        .dark .main-title {
            background: linear-gradient(135deg, #8B5CF6 0%, #06B6D4 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .title-badge {
            background: linear-gradient(135deg, #667eea20, #764ba240);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        .dark .title-badge {
            background: linear-gradient(135deg, #8B5CF620, #06B6D440);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .sync-status {
            @apply text-xs px-2 py-1 rounded-full;
        }
        .sync-success { @apply bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300; }
        .sync-error { @apply bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300; }
        .loading {
            @apply opacity-50 pointer-events-none;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 min-h-screen">
    <!-- Supabase ì„¤ì • ëª¨ë‹¬ -->
    <div id="configModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl max-w-md w-full mx-4">
            <h2 class="text-xl font-bold mb-4 dark:text-white">Supabase ì„¤ì •</h2>
            <div class="text-sm text-gray-600 dark:text-gray-400 mb-4">
                <p>Supabase ë°ì´í„°ë² ì´ìŠ¤ì— ì—°ê²°í•˜ì—¬ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ í´ë¼ìš°ë“œì— ì €ì¥í•©ë‹ˆë‹¤.</p>
                <p class="mt-2 text-xs">âš ï¸ Supabase ì—°ê²° ë° êµì‚¬ ë¡œê·¸ì¸ ì—†ì´ëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2 dark:text-white">êµì‚¬ ì•„ì´ë””</label>
                    <input type="text" id="teacherIdInput" 
                           placeholder="êµì‚¬ ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”" 
                           class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">ë“±ë¡ëœ êµì‚¬ ì•„ì´ë””ë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2 dark:text-white">Supabase URL</label>
                    <input type="url" id="supabaseUrl" 
                           placeholder="https://your-project.supabase.co" 
                           class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2 dark:text-white">Supabase Anon Key</label>
                    <input type="password" id="supabaseKey" 
                           placeholder="your-anon-key" 
                           class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                </div>
                <div class="flex gap-2">
                    <button onclick="saveSupabaseConfig()" 
                            class="flex-1 bg-blue-500 text-white p-2 rounded hover:bg-blue-600 transition-colors">
                        ì—°ê²°í•˜ê¸°
                    </button>
                    <button onclick="resetUserId()" 
                            class="px-4 bg-gray-500 text-white p-2 rounded hover:bg-gray-600 transition-colors text-sm">
                        ID ì´ˆê¸°í™”
                    </button>
                </div>
                <div class="text-xs text-gray-500 dark:text-gray-400">
                    <p>ğŸ’¡ Supabase ì„¤ì • ë°©ë²•:</p>
                    <p>1. supabase.comì—ì„œ í”„ë¡œì íŠ¸ ìƒì„±</p>
                    <p>2. SQL Editorì—ì„œ í…Œì´ë¸” ìƒì„± (ì•„ë˜ ì¿¼ë¦¬ ì‚¬ìš©)</p>
                    <p>3. Settings > APIì—ì„œ URLê³¼ Key ë³µì‚¬</p>
                    <p>4. ê¸°ì¡´ ë°ì´í„°ê°€ ìˆë‹¤ë©´: <code>UPDATE checklists SET teacher_id = 'seol3196';</code></p>
                    <p>5. êµì‚¬ ê³„ì • ìƒì„±: <code>INSERT INTO teachers (teacher_id, name) VALUES ('seol3196', 'ì„¤ìƒ˜');</code></p>
                </div>
                <div class="bg-gray-100 dark:bg-gray-700 p-3 rounded text-xs">
                    <p class="font-semibold mb-2">í…Œì´ë¸” ìƒì„± SQL:</p>
                    <pre class="text-xs overflow-x-auto">-- êµì‚¬ í…Œì´ë¸” ìƒì„±
CREATE TABLE teachers (
    id SERIAL PRIMARY KEY,
    teacher_id TEXT UNIQUE NOT NULL,
    name TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);

ALTER TABLE teachers DISABLE ROW LEVEL SECURITY;

-- êµì‚¬ ê³„ì • ì¶”ê°€
INSERT INTO teachers (teacher_id, name) VALUES 
('seol3196', 'ì„¤ìƒ˜'),
('jangyerim', 'ì¥ì˜ˆë¦¼ìƒ˜');

-- ì²´í¬ë¦¬ìŠ¤íŠ¸ í…Œì´ë¸” ìƒì„±
CREATE TABLE checklists (
    id BIGINT PRIMARY KEY,
    user_id TEXT NOT NULL,
    teacher_id TEXT NOT NULL,
    name TEXT NOT NULL,
    category TEXT NOT NULL,
    student_count INTEGER NOT NULL,
    statuses INTEGER[] NOT NULL,
    completion_times TIMESTAMP[],
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

ALTER TABLE checklists DISABLE ROW LEVEL SECURITY;

-- ì¸ë±ìŠ¤ ìƒì„±
CREATE INDEX idx_checklists_teacher_id ON checklists(teacher_id);
CREATE INDEX idx_checklists_user_id ON checklists(user_id);</pre>
                </div>
            </div>
        </div>
    </div>

    <div class="container mx-auto p-4">
        <!-- í”„ë¡œê·¸ë¨ ì œëª© -->
        <div class="text-center mb-8 mt-6">
            <div class="inline-block mb-4">
                <h1 class="main-title text-5xl font-bold mb-2">âœ… ë‹¤í–ˆì–´ìš”!</h1>
                <div class="w-full h-1 bg-gradient-to-r from-blue-500 via-purple-500 to-blue-500 rounded-full"></div>
            </div>
            <p class="title-badge text-gray-700 dark:text-gray-200 font-medium rounded-full px-6 py-3 inline-block shadow-lg">
                ğŸ“‹ í•™ê¸‰ ì²´í¬ë¦¬ìŠ¤íŠ¸ ê´€ë¦¬ ì‹œìŠ¤í…œ
            </p>
        </div>
        
        <div class="flex justify-end mb-4">
            <div class="flex items-center gap-4">
                <div id="syncStatus" class="sync-status hidden">ë™ê¸°í™” ì¤‘...</div>
                <span class="clock text-gray-900 dark:text-white" id="clock"></span>
                <button class="flex items-center gap-2 px-3 py-2 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors text-gray-900 dark:text-white" 
                        onclick="toggleDarkMode()">
                    <span id="darkModeIcon">ğŸŒ™</span>
                    <span>ë‹¤í¬ëª¨ë“œ</span>
                </button>
                <button onclick="showConfig()" 
                        class="flex items-center gap-2 px-3 py-2 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors text-gray-900 dark:text-white">
                    âš™ï¸ ì„¤ì •
                </button>
            </div>
        </div>
        
        <div class="flex gap-4">
            <!-- ì¢Œì¸¡ ì²´í¬ë¦¬ìŠ¤íŠ¸ ëª©ë¡ -->
            <div class="w-1/4 bg-white dark:bg-gray-800 rounded-lg shadow p-4">
                <h2 class="text-xl font-bold mb-4 dark:text-gray-100">Checklist</h2>
                <div class="mb-4">
                    <input type="number" id="studentCount" placeholder="í•™ìƒ ìˆ˜ ì…ë ¥ (ìµœëŒ€ 100ëª…)" 
                           class="w-full p-2 border rounded-full mb-2 bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100" 
                           min="1" max="100">
                    <select id="categorySelect" class="w-full p-2 border rounded-full mb-2 bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100">
                        <option value="ì¼ë°˜">ğŸ—’ï¸ ì¼ë°˜</option>
                        <option value="êµ­ì–´">ğŸ“’ êµ­ì–´</option>
                        <option value="ìˆ˜í•™">ğŸ§® ìˆ˜í•™</option>
                        <option value="ì‚¬íšŒ">ğŸ‘¥ ì‚¬íšŒ</option>
                        <option value="ê³¼í•™">ğŸ”¬ ê³¼í•™</option>
                        <option value="ì˜ì–´">ğŸ‡ºğŸ‡¸ ì˜ì–´</option>
                        <option value="ë„ë•">ğŸ¤ ë„ë•</option>
                        <option value="ì‹¤ê³¼">ğŸ§¶ ì‹¤ê³¼</option>
                        <option value="ìŒì•…">ğŸµ ìŒì•…</option>
                        <option value="ë¯¸ìˆ ">ğŸ¨ ë¯¸ìˆ </option>
                        <option value="ì²´ìœ¡">ğŸƒ ì²´ìœ¡</option>
                        <option value="ì°½ì²´">ğŸ‘¥ ì°½ì²´</option>
                        <option value="ì•„ì¹¨í™œë™">ğŸŒ ì•„ì¹¨í™œë™</option>
                        <option value="ë…ì„œ">ğŸ¤“ ë…ì„œ</option>
                        <option value="ê¸°íƒ€">ğŸ¤” ê¸°íƒ€</option>
                    </select>
                    <button id="createChecklist" 
                            class="w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600 flex items-center justify-center gap-2 transition-colors"
                            onclick="createChecklist()">
                        â• ì¶”ê°€
                    </button>
                </div>
                <div class="mb-4">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="font-semibold dark:text-gray-100">ëª©ë¡</h3>
                        <button onclick="toggleCategoryFilter()" class="icon-btn dark:text-white">
                            ğŸ”
                        </button>
                    </div>
                    <div id="categoryFilter" class="hidden space-y-1">
                        <label class="flex items-center dark:text-white">
                            <input type="checkbox" value="all" checked class="mr-2" onchange="filterChecklists()">
                            ì „ì²´
                        </label>
                        <div id="categoryCheckboxes" class="space-y-1 dark:text-white"></div>
                    </div>
                </div>
                <div id="checklistList" class="space-y-2"></div>
                <div class="text-center text-xs text-gray-400 dark:text-gray-500 mt-4">
                    <div>by í–‰ë³µí•œì—„ìŒ¤</div>
                    <div id="storageInfo" class="mt-1">â˜ï¸ Supabase</div>
                </div>
            </div>

        <!-- ìš°ì¸¡ ì²´í¬ë¦¬ìŠ¤íŠ¸ ë‚´ìš© -->
            <div class="w-3/4 bg-white dark:bg-gray-800 rounded-lg shadow p-4">
                <div id="noConnection" class="text-center py-8 text-gray-500 dark:text-gray-400">
                    <div class="text-4xl mb-4">â˜ï¸</div>
                    <div class="text-lg font-semibold mb-2">Supabaseì— ì—°ê²°í•´ì£¼ì„¸ìš”</div>
                    <div class="text-sm">ì„¤ì • ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì—°ê²°í•˜ì„¸ìš”.</div>
                </div>
                
                <div id="mainContent" class="hidden">
                    <div class="flex justify-between items-center mb-4">
                        <div class="flex-1">
                            <div class="flex items-center gap-2">
                                <select id="editCategorySelect" 
                                        class="p-2 border rounded-full bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-gray-100" 
                                        onchange="updateCurrentChecklist()">
                                    <option value="ì¼ë°˜">ğŸ—’ï¸ ì¼ë°˜</option>
                                    <option value="êµ­ì–´">ğŸ“’ êµ­ì–´</option>
                                    <option value="ìˆ˜í•™">ğŸ§® ìˆ˜í•™</option>
                                    <option value="ì‚¬íšŒ">ğŸ‘¥ ì‚¬íšŒ</option>
                                    <option value="ê³¼í•™">ğŸ”¬ ê³¼í•™</option>
                                    <option value="ì˜ì–´">ğŸ‡ºğŸ‡¸ ì˜ì–´</option>
                                    <option value="ë„ë•">ğŸ¤ ë„ë•</option>
                                    <option value="ì‹¤ê³¼">ğŸ§¶ ì‹¤ê³¼</option>
                                    <option value="ìŒì•…">ğŸµ ìŒì•…</option>
                                    <option value="ë¯¸ìˆ ">ğŸ¨ ë¯¸ìˆ </option>
                                    <option value="ì²´ìœ¡">ğŸƒ ì²´ìœ¡</option>
                                    <option value="ì°½ì²´">ğŸ‘¥ ì°½ì²´</option>
                                    <option value="ì•„ì¹¨í™œë™">ğŸŒ ì•„ì¹¨í™œë™</option>
                                    <option value="ë…ì„œ">ğŸ¤“ ë…ì„œ</option>
                                    <option value="ê¸°íƒ€">ğŸ¤” ê¸°íƒ€</option>
                                </select>
                                <input type="text" id="checklistTitle" 
                                       class="flex-1 text-xl font-bold bg-transparent border-b border-transparent hover:border-gray-300 focus:border-blue-500 focus:outline-none px-1 dark:text-gray-100 dark:border-gray-600" 
                                       onchange="updateCurrentChecklist()">
                            </div>
                            <div id="checklistInfo" class="text-sm text-gray-400 dark:text-gray-500 mt-1"></div>
                        </div>
                        <div id="checklistActions" class="hidden">
                            <button onclick="deleteCurrentChecklist()" 
                                    class="icon-btn text-red-500 hover:bg-red-100 dark:hover:bg-red-900">
                                ğŸ—‘ï¸
                            </button>
                        </div>
                    </div>
                    
                    <div id="checklistContent" class="grid grid-cols-5 gap-3 mb-6"></div>
                    
                    <!-- í†µê³„ ì„¹ì…˜ -->
                    <div id="statistics" class="border-t border-gray-200 dark:border-gray-600 pt-4 hidden">
                        <h3 class="text-lg font-semibold mb-3 dark:text-gray-100">ìƒíƒœë³„ í†µê³„</h3>
                        <div class="grid grid-cols-5 gap-4 mb-4">
                            <div class="text-center">
                                <div class="bg-green-500 text-white p-2 rounded mb-1">ì™„ë£Œ</div>
                                <div class="text-sm dark:text-gray-100">
                                    <span id="completedCount">0</span>ëª…
                                    (<span id="completedPercent">0.0</span>%)
                                </div>
                            </div>
                            <div class="text-center">
                                <div class="bg-yellow-500 text-white p-2 rounded mb-1">ì§„í–‰ì¤‘</div>
                                <div class="text-sm dark:text-gray-100">
                                    <span id="inProgressCount">0</span>ëª…
                                    (<span id="inProgressPercent">0.0</span>%)
                                </div>
                            </div>
                            <div class="text-center">
                                <div class="bg-orange-500 text-white p-2 rounded mb-1">ì¬ì œì¶œ</div>
                                <div class="text-sm dark:text-gray-100">
                                    <span id="resubmitCount">0</span>ëª…
                                    (<span id="resubmitPercent">0.0</span>%)
                                </div>
                            </div>
                            <div class="text-center">
                                <div class="bg-gray-500 text-white p-2 rounded mb-1">ë¯¸ì™„ë£Œ</div>
                                <div class="text-sm dark:text-gray-100">
                                    <span id="incompleteCount">0</span>ëª…
                                    (<span id="incompletePercent">0.0</span>%)
                                </div>
                            </div>
                            <div class="text-center">
                                <div class="bg-red-500 text-white p-2 rounded mb-1">ë¯¸ì œì¶œë§ˆê°</div>
                                <div class="text-sm dark:text-gray-100">
                                    <span id="deadlineCount">0</span>ëª…
                                    (<span id="deadlinePercent">0.0</span>%)
                                </div>
                            </div>
                        </div>
                        <!-- í”„ë¡œê·¸ë ˆìŠ¤ ë°” -->
                        <div class="mt-4">
                            <div class="flex h-6 rounded-full overflow-hidden">
                                <div id="completedBar" class="bg-green-500 transition-all duration-500" style="width: 0%"></div>
                                <div id="inProgressBar" class="bg-yellow-500 transition-all duration-500" style="width: 0%"></div>
                                <div id="resubmitBar" class="bg-orange-500 transition-all duration-500" style="width: 0%"></div>
                                <div id="incompleteBar" class="bg-gray-500 transition-all duration-500" style="width: 100%"></div>
                                <div id="deadlineBar" class="bg-red-500 transition-all duration-500" style="width: 0%"></div>
                            </div>
                            <div class="flex justify-between mt-2 text-xs text-gray-500 dark:text-gray-400">
                                <span>0%</span>
                                <span>100%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ìƒíƒœ ìƒìˆ˜ ì •ì˜
        const STATUS = {
            INCOMPLETE: { id: 0, color: 'bg-gray-500', text: 'ë¯¸ì™„ë£Œ' },
            COMPLETED: { id: 1, color: 'bg-green-500', text: 'ì™„ë£Œ' },
            IN_PROGRESS: { id: 2, color: 'bg-yellow-500', text: 'ì§„í–‰ì¤‘' },
            RESUBMIT: { id: 3, color: 'bg-orange-500', text: 'ì¬ì œì¶œ' },
            DEADLINE_PASSED: { id: 4, color: 'bg-red-500', text: 'ë¯¸ì œì¶œë§ˆê°' }
        };

        // Supabase ê´€ë ¨ ë³€ìˆ˜
        let supabase = null;
        let userId = null;
        let teacherId = null;

        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ í‚¤ (ì„¤ì • ì •ë³´ë§Œ ì €ì¥)
        const STORAGE_KEYS = {
            DARK_MODE: 'darkMode',
            STUDENT_COUNT: 'studentCount',
            LAST_VIEWED: 'lastViewedChecklist',
            SUPABASE_URL: 'supabaseUrl',
            SUPABASE_KEY: 'supabaseKey',
            USER_ID: 'userId',
            TEACHER_ID: 'teacherId'
        };

        // ì•± ìƒíƒœ (ë©”ëª¨ë¦¬ì—ë§Œ ì €ì¥)
        let checklists = [];
        let currentChecklistId = null;
        let isDarkMode = localStorage.getItem(STORAGE_KEYS.DARK_MODE) === 'true';

        // ìƒíƒœ IDë¥¼ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
        function getStatusById(id) {
            return Object.values(STATUS).find(status => status.id === id);
        }

        // ì‚¬ìš©ì ID ì´ˆê¸°í™”
        function resetUserId() {
            localStorage.removeItem(STORAGE_KEYS.USER_ID);
            alert('ì‚¬ìš©ì IDê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.');
            location.reload();
        }

        // ì‚¬ìš©ì ID ìƒì„± (ê³ ì • ID ì‚¬ìš©)
        function generateUserId() {
            // ê³ ì • ì‚¬ìš©ì ID ì‚¬ìš© (ëª¨ë“  ê¸°ê¸°ì—ì„œ ë™ì¼)
            return 'default_user';
        }

        // Supabase ì´ˆê¸°í™”
        async function initSupabase() {
            const savedUrl = localStorage.getItem(STORAGE_KEYS.SUPABASE_URL);
            const savedKey = localStorage.getItem(STORAGE_KEYS.SUPABASE_KEY);
            const savedTeacherId = localStorage.getItem(STORAGE_KEYS.TEACHER_ID);

            console.log('Initializing Supabase with:', { 
                savedUrl, 
                savedKey: savedKey ? '***' : 'none',
                savedTeacherId 
            });

            if (savedUrl && savedKey && savedTeacherId) {
                try {
                    supabase = window.supabase.createClient(savedUrl, savedKey);
                    
                    // êµì‚¬ ID ê²€ì¦
                    const teacherData = await validateTeacherId(savedTeacherId);
                    if (!teacherData) {
                        throw new Error('ì €ì¥ëœ êµì‚¬ ì•„ì´ë””ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                    }

                    teacherId = savedTeacherId;
                    
                    // ì‚¬ìš©ì ID ìƒì„± ë˜ëŠ” ê°€ì ¸ì˜¤ê¸°
                    userId = localStorage.getItem(STORAGE_KEYS.USER_ID) || generateUserId();
                    localStorage.setItem(STORAGE_KEYS.USER_ID, userId);
                    
                    console.log('Teacher ID:', teacherId);
                    console.log('User ID:', userId);
                    
                    document.getElementById('configModal').style.display = 'none';
                    document.getElementById('noConnection').classList.add('hidden');
                    document.getElementById('mainContent').classList.remove('hidden');
                    
                    await loadChecklists();
                    
                    showSyncStatus('success', `${teacherData.name || teacherId}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!`);
                    
                    // êµì‚¬ ì •ë³´ í‘œì‹œ
                    const teacherInfoEl = document.getElementById('teacherInfo');
                    if (teacherInfoEl) {
                        teacherInfoEl.textContent = `ğŸ‘¨â€ğŸ« ${teacherData.name || teacherId}`;
                    }
                    
                    setTimeout(() => hideSyncStatus(), 3000);
                } catch (error) {
                    console.error('Supabase ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                    showSyncStatus('error', 'Supabase ì—°ê²° ì‹¤íŒ¨');
                    document.getElementById('configModal').style.display = 'flex';
                    document.getElementById('noConnection').classList.remove('hidden');
                    document.getElementById('mainContent').classList.add('hidden');
                }
            } else {
                console.log('No saved Supabase config or teacher ID, showing modal');
                document.getElementById('configModal').style.display = 'flex';
                document.getElementById('noConnection').classList.remove('hidden');
                document.getElementById('mainContent').classList.add('hidden');
            }
        }

        // êµì‚¬ ID ê²€ì¦
        async function validateTeacherId(inputTeacherId) {
            if (!supabase) return false;
            
            try {
                const { data, error } = await supabase
                    .from('teachers')
                    .select('teacher_id, name')
                    .eq('teacher_id', inputTeacherId)
                    .single();
                
                if (error || !data) {
                    return false;
                }
                
                return data;
            } catch (error) {
                console.error('êµì‚¬ ID ê²€ì¦ ì‹¤íŒ¨:', error);
                return false;
            }
        }

        // Supabase ì„¤ì • ì €ì¥
        async function saveSupabaseConfig() {
            const url = document.getElementById('supabaseUrl').value.trim();
            const key = document.getElementById('supabaseKey').value.trim();
            const inputTeacherId = document.getElementById('teacherIdInput').value.trim();

            if (!url || !key) {
                alert('URLê³¼ Keyë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            if (!inputTeacherId) {
                alert('êµì‚¬ ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                showSyncStatus('syncing', 'ì—°ê²° ì¤‘...');
                
                // Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„± ë° í…ŒìŠ¤íŠ¸
                const testClient = window.supabase.createClient(url, key);
                supabase = testClient; // ì„ì‹œë¡œ ì„¤ì • (ê²€ì¦ìš©)
                
                // êµì‚¬ ID ê²€ì¦
                const teacherData = await validateTeacherId(inputTeacherId);
                if (!teacherData) {
                    throw new Error('ë“±ë¡ë˜ì§€ ì•Šì€ êµì‚¬ ì•„ì´ë””ì…ë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.');
                }

                console.log('êµì‚¬ ì •ë³´:', teacherData);

                // ì—°ê²° í…ŒìŠ¤íŠ¸
                const { data, error } = await testClient.from('checklists').select('id').limit(1);
                
                if (error) {
                    console.error('Connection test error:', error);
                    if (error.code === 'PGRST116') {
                        throw new Error('checklists í…Œì´ë¸”ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë¨¼ì € í…Œì´ë¸”ì„ ìƒì„±í•´ì£¼ì„¸ìš”.');
                    } else if (error.code === '42501') {
                        throw new Error('ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. RLS ì •ì±…ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                    } else {
                        throw new Error('ì—°ê²° ì‹¤íŒ¨: ' + error.message);
                    }
                }

                console.log('Connection test successful');

                // ì„¤ì • ì €ì¥ (ë¡œì»¬ ìŠ¤í† ë¦¬ì§€)
                localStorage.setItem(STORAGE_KEYS.SUPABASE_URL, url);
                localStorage.setItem(STORAGE_KEYS.SUPABASE_KEY, key);
                localStorage.setItem(STORAGE_KEYS.TEACHER_ID, inputTeacherId);

                teacherId = inputTeacherId;
                userId = localStorage.getItem(STORAGE_KEYS.USER_ID) || generateUserId();
                localStorage.setItem(STORAGE_KEYS.USER_ID, userId);

                document.getElementById('configModal').style.display = 'none';
                document.getElementById('noConnection').classList.add('hidden');
                document.getElementById('mainContent').classList.remove('hidden');
                
                // ë°ì´í„° ë¡œë“œ
                await loadChecklists();
                
                showSyncStatus('success', `${teacherData.name || teacherData.teacher_id}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!`);
                setTimeout(() => hideSyncStatus(), 3000);
            } catch (error) {
                console.error('Supabase ì—°ê²° ì‹¤íŒ¨:', error);
                alert('ì—°ê²° ì‹¤íŒ¨:\n\n' + error.message + '\n\ní™•ì¸ì‚¬í•­:\n1. URLê³¼ Keyê°€ ì •í™•í•œê°€ìš”?\n2. í…Œì´ë¸”ì´ ìƒì„±ë˜ì—ˆë‚˜ìš”?\n3. êµì‚¬ ì•„ì´ë””ê°€ ë“±ë¡ë˜ì—ˆë‚˜ìš”?');
                showSyncStatus('error', 'ì—°ê²° ì‹¤íŒ¨');
                setTimeout(() => hideSyncStatus(), 3000);
                supabase = null; // ì‹¤íŒ¨ ì‹œ ì´ˆê¸°í™”
            }
        }

        // ì„¤ì • ëª¨ë‹¬ í‘œì‹œ
        function showConfig() {
            document.getElementById('teacherIdInput').value = localStorage.getItem(STORAGE_KEYS.TEACHER_ID) || '';
            document.getElementById('supabaseUrl').value = localStorage.getItem(STORAGE_KEYS.SUPABASE_URL) || '';
            document.getElementById('supabaseKey').value = localStorage.getItem(STORAGE_KEYS.SUPABASE_KEY) || '';
            document.getElementById('configModal').style.display = 'flex';
        }

        // ë™ê¸°í™” ìƒíƒœ í‘œì‹œ
        function showSyncStatus(type, message) {
            const statusEl = document.getElementById('syncStatus');
            statusEl.className = `sync-status sync-${type}`;
            statusEl.textContent = message;
            statusEl.classList.remove('hidden');
        }

        function hideSyncStatus() {
            document.getElementById('syncStatus').classList.add('hidden');
        }

        // ì²´í¬ë¦¬ìŠ¤íŠ¸ ë¡œë“œ
        async function loadChecklists() {
            if (!supabase) {
                console.log('Supabase not initialized');
                return;
            }

            try {
                showSyncStatus('syncing', 'ë°ì´í„° ë¡œë“œ ì¤‘...');
                
                console.log('Loading checklists for teacher:', teacherId, 'user:', userId);
                
                const { data, error } = await supabase
                    .from('checklists')
                    .select('*')
                    .eq('teacher_id', teacherId)
                    .eq('user_id', userId)
                    .order('created_at', { ascending: false });

                console.log('Supabase response:', { data, error });

                if (error) {
                    console.error('Supabase load error:', error);
                    throw error;
                }

                if (!data) {
                    console.log('No data returned from Supabase');
                    checklists = [];
                } else {
                    console.log('Raw data from Supabase:', data);
                    
                    checklists = data.map(item => {
                        console.log('Processing item:', item);
                        return {
                            id: item.id,
                            n: item.name,
                            c: item.category,
                            sc: item.student_count,
                            s: item.statuses,
                            ct: item.created_at,
                            ut: item.updated_at,
                            t: item.completion_times || Array(item.student_count).fill(null)
                        };
                    });
                    
                    console.log('Processed checklists:', checklists);
                }

                hideSyncStatus();

                renderChecklistList();
                updateCategoryCheckboxes();
                
                // ë§ˆì§€ë§‰ìœ¼ë¡œ ë³¸ ì²´í¬ë¦¬ìŠ¤íŠ¸ ì„ íƒ
                const lastViewedId = localStorage.getItem(STORAGE_KEYS.LAST_VIEWED);
                console.log('Last viewed ID:', lastViewedId);
                
                if (lastViewedId && checklists.some(c => c.id == lastViewedId)) {
                    console.log('Selecting last viewed checklist:', lastViewedId);
                    selectChecklist(parseInt(lastViewedId));
                } else if (checklists.length > 0) {
                    console.log('Selecting first checklist:', checklists[0].id);
                    selectChecklist(checklists[0].id);
                } else {
                    console.log('No checklists to select');
                }
                
            } catch (error) {
                console.error('ì²´í¬ë¦¬ìŠ¤íŠ¸ ë¡œë“œ ì‹¤íŒ¨:', error);
                showSyncStatus('error', 'ë¡œë“œ ì‹¤íŒ¨: ' + error.message);
                setTimeout(() => hideSyncStatus(), 5000);
                
                // ë¹ˆ ë°°ì—´ë¡œ ì´ˆê¸°í™”
                checklists = [];
                renderChecklistList();
                updateCategoryCheckboxes();
            }
        }

        // Supabaseì— ì²´í¬ë¦¬ìŠ¤íŠ¸ ì €ì¥
        async function saveChecklistToSupabase(checklist) {
            if (!supabase) return;

            try {
                const checklistData = {
                    id: checklist.id,
                    user_id: userId,
                    teacher_id: teacherId,
                    name: checklist.n,
                    category: checklist.c,
                    student_count: checklist.sc,
                    statuses: checklist.s,
                    completion_times: checklist.t || Array(checklist.sc).fill(null),
                    created_at: checklist.ct,
                    updated_at: new Date().toISOString()
                };

                console.log('Saving to Supabase:', checklistData);

                const { data, error } = await supabase
                    .from('checklists')
                    .upsert(checklistData, { 
                        onConflict: 'id',
                        ignoreDuplicates: false 
                    });

                if (error) {
                    console.error('Supabase error details:', error);
                    throw error;
                }

                console.log('Successfully saved to Supabase:', data);
            } catch (error) {
                console.error('Supabase ì €ì¥ ì‹¤íŒ¨:', error);
                throw error;
            }
        }

        // ì²´í¬ë¦¬ìŠ¤íŠ¸ ìƒì„±
        async function createChecklist() {
            if (!supabase) {
                alert('Supabaseì— ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                return;
            }

            const studentCount = parseInt(document.getElementById('studentCount').value);
            const category = document.getElementById('categorySelect').value;
            
            if (!studentCount || studentCount <= 0) {
                alert('ìœ íš¨í•œ í•™ìƒ ìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            if (studentCount > 100) {
                alert('í•™ìƒ ìˆ˜ëŠ” ìµœëŒ€ 100ëª…ê¹Œì§€ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                return;
            }

            const now = new Date().toISOString();
            const checklist = {
                id: Date.now(),
                n: `ì²´í¬ë¦¬ìŠ¤íŠ¸ ${checklists.length + 1}`,
                c: category,
                sc: studentCount,
                s: Array(studentCount).fill(0),
                ct: now,
                ut: now,
                t: Array(studentCount).fill(null)
            };

            checklists.unshift(checklist); // ë©”ëª¨ë¦¬ì—ë§Œ ì¶”ê°€
            
            try {
                showSyncStatus('syncing', 'ì €ì¥ ì¤‘...');
                await saveChecklistToSupabase(checklist);
                showSyncStatus('success', 'ì €ì¥ë¨');
                setTimeout(() => hideSyncStatus(), 1000);
                
                renderChecklistList();
                selectChecklist(checklist.id);
                updateCategoryCheckboxes();
                
                // í•™ìƒ ìˆ˜ ì €ì¥
                localStorage.setItem(STORAGE_KEYS.STUDENT_COUNT, studentCount);
            } catch (error) {
                console.error('ì²´í¬ë¦¬ìŠ¤íŠ¸ ìƒì„± ì‹¤íŒ¨:', error);
                showSyncStatus('error', 'ì €ì¥ ì‹¤íŒ¨');
                setTimeout(() => hideSyncStatus(), 3000);
                // ì‹¤íŒ¨ ì‹œ ë©”ëª¨ë¦¬ì—ì„œ ì œê±°
                checklists.shift();
                renderChecklistList();
            }
        }

        // ì¹´í…Œê³ ë¦¬ ì²´í¬ë°•ìŠ¤ ì—…ë°ì´íŠ¸
        function updateCategoryCheckboxes() {
            const container = document.getElementById('categoryCheckboxes');
            const categories = [...new Set(checklists.map(c => c.c))];
            container.innerHTML = categories.map(category => `
                <label class="flex items-center">
                    <input type="checkbox" value="${category}" checked 
                           class="mr-2" onchange="filterChecklists()">
                    ${category}
                </label>
            `).join('');
        }

        // ì¹´í…Œê³ ë¦¬ í•„í„° í† ê¸€
        function toggleCategoryFilter() {
            const filter = document.getElementById('categoryFilter');
            filter.classList.toggle('hidden');
        }

        // ì²´í¬ë¦¬ìŠ¤íŠ¸ í•„í„°ë§
        function filterChecklists() {
            const checkboxes = document.querySelectorAll('#categoryFilter input[type="checkbox"]');
            const selectedCategories = Array.from(checkboxes)
                .filter(cb => cb.checked)
                .map(cb => cb.value);

            const listContainer = document.getElementById('checklistList');
            const items = listContainer.getElementsByClassName('checklist-item');
            
            Array.from(items).forEach(item => {
                const category = item.dataset.category;
                if (selectedCategories.includes('all') || selectedCategories.includes(category)) {
                    item.classList.remove('hidden');
                } else {
                    item.classList.add('hidden');
                }
            });
        }

        // ì²´í¬ë¦¬ìŠ¤íŠ¸ ëª©ë¡ ë Œë”ë§
        function renderChecklistList() {
            const listContainer = document.getElementById('checklistList');
            
            console.log('Rendering checklist list, checklists count:', checklists.length);
            console.log('Checklists data:', checklists);
            
            if (checklists.length === 0) {
                listContainer.innerHTML = '<div class="text-center text-gray-500 dark:text-gray-400 py-4">ì²´í¬ë¦¬ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            listContainer.innerHTML = checklists.map((checklist, index) => {
                const truncatedTitle = checklist.n.length > 15 ? checklist.n.substring(0, 15) + '...' : checklist.n;
                return `
                <div class="checklist-item flex items-center p-2 bg-gray-50 rounded cursor-pointer hover:bg-gray-100 ${currentChecklistId === checklist.id ? 'bg-blue-100 dark:bg-blue-900' : ''} dark:bg-gray-700 dark:hover:bg-gray-600"
                     onclick="selectChecklist(${checklist.id})"
                     data-category="${checklist.c}">
                    <div class="flex-1 flex items-center gap-2 min-w-0">
                        <span class="flex-shrink-0 px-2 py-0.5 text-xs rounded-full bg-gray-200 dark:bg-gray-600 text-gray-600 dark:text-gray-300">${checklist.c}</span>
                        <span class="truncate dark:text-gray-100 flex-1 min-w-0" title="${checklist.n}">${truncatedTitle}</span>
                    </div>
                </div>
            `}).join('');
            
            console.log('Rendered HTML:', listContainer.innerHTML);
        }

        // ì²´í¬ë¦¬ìŠ¤íŠ¸ ì„ íƒ
        function selectChecklist(id) {
            currentChecklistId = id;
            localStorage.setItem(STORAGE_KEYS.LAST_VIEWED, id);
            
            const checklist = checklists.find(c => c.id === id);
            if (checklist) {
                document.getElementById('checklistActions').classList.remove('hidden');
                document.getElementById('statistics').classList.remove('hidden');
                document.getElementById('checklistTitle').value = checklist.n;
                
                // ì¹´í…Œê³ ë¦¬ ì„ íƒ ì˜µì…˜ ì—…ë°ì´íŠ¸
                const categorySelect = document.getElementById('editCategorySelect');
                categorySelect.value = checklist.c;
                
                // ìƒì„±/ìˆ˜ì • ì‹œê° í‘œì‹œ (í•œêµ­ ì‹œê°„)
                const createdAt = new Date(checklist.ct);
                const updatedAt = new Date(checklist.ut);
                
                const createdKST = createdAt.toLocaleString('ko-KR', {
                    timeZone: 'Asia/Seoul',
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: false
                });
                
                const updatedKST = updatedAt.toLocaleString('ko-KR', {
                    timeZone: 'Asia/Seoul',
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: false
                });
                
                document.getElementById('checklistInfo').innerHTML = `
                    ìƒì„±: ${createdKST} | 
                    ìˆ˜ì •: ${updatedKST}
                `;

                renderChecklistContent(checklist);
                updateStatistics(checklist);
                renderChecklistList();
            }
        }

        // í˜„ì¬ ì²´í¬ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        async function updateCurrentChecklist() {
            if (!currentChecklistId || !supabase) return;
            
            const newName = document.getElementById('checklistTitle').value;
            const newCategory = document.getElementById('editCategorySelect').value;
            const checklist = checklists.find(c => c.id === currentChecklistId);
            
            if (checklist) {
                checklist.n = newName;
                checklist.c = newCategory;
                checklist.ut = new Date().toISOString();
                
                try {
                    showSyncStatus('syncing', 'ì €ì¥ ì¤‘...');
                    await saveChecklistToSupabase(checklist);
                    showSyncStatus('success', 'ì €ì¥ë¨');
                    setTimeout(() => hideSyncStatus(), 1000);
                    
                    renderChecklistList();
                    selectChecklist(currentChecklistId);
                    updateCategoryCheckboxes();
                } catch (error) {
                    console.error('ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
                    showSyncStatus('error', 'ì €ì¥ ì‹¤íŒ¨');
                    setTimeout(() => hideSyncStatus(), 3000);
                }
            }
        }

        // í˜„ì¬ ì²´í¬ë¦¬ìŠ¤íŠ¸ ì‚­ì œ
        async function deleteCurrentChecklist() {
            if (!currentChecklistId || !supabase) return;
            
            if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                try {
                    showSyncStatus('syncing', 'ì‚­ì œ ì¤‘...');
                    const { error } = await supabase
                        .from('checklists')
                        .delete()
                        .eq('id', currentChecklistId)
                        .eq('teacher_id', teacherId)
                        .eq('user_id', userId);
                    
                    if (error) throw error;
                    
                    showSyncStatus('success', 'ì‚­ì œë¨');
                    setTimeout(() => hideSyncStatus(), 1000);
                    
                    checklists = checklists.filter(c => c.id !== currentChecklistId);
                    
                    currentChecklistId = null;
                    document.getElementById('checklistActions').classList.add('hidden');
                    document.getElementById('statistics').classList.add('hidden');
                    document.getElementById('checklistContent').innerHTML = '';
                    document.getElementById('checklistTitle').value = '';
                    document.getElementById('checklistInfo').innerHTML = '';
                    
                    renderChecklistList();
                    updateCategoryCheckboxes();
                } catch (error) {
                    console.error('ì‚­ì œ ì‹¤íŒ¨:', error);
                    showSyncStatus('error', 'ì‚­ì œ ì‹¤íŒ¨');
                    setTimeout(() => hideSyncStatus(), 3000);
                }
            }
        }

        // ìƒíƒœ ë³€ê²½
        async function changeStatus(checklistId, studentIndex) {
            if (!supabase) return;

            const checklist = checklists.find(c => c.id === checklistId);
            if (checklist) {
                const currentStatusId = checklist.s[studentIndex];
                const statusKeys = Object.values(STATUS);
                const currentIndex = statusKeys.findIndex(status => status.id === currentStatusId);
                const nextIndex = (currentIndex + 1) % statusKeys.length;
                const nextStatus = statusKeys[nextIndex];
                
                checklist.s[studentIndex] = nextStatus.id;
                
                // ì™„ë£Œ ìƒíƒœë¡œ ë³€ê²½ë  ë•Œ ì‹œê°„ ê¸°ë¡
                if (nextStatus.id === 1) { // COMPLETED
                    checklist.t[studentIndex] = new Date().toISOString();
                } else if (currentStatusId === 1) { // ì™„ë£Œì—ì„œ ë‹¤ë¥¸ ìƒíƒœë¡œ ë³€ê²½ë  ë•Œ
                    checklist.t[studentIndex] = null;
                }
                
                checklist.ut = new Date().toISOString();
                
                try {
                    await saveChecklistToSupabase(checklist);
                    renderChecklistContent(checklist);
                    updateStatistics(checklist);
                } catch (error) {
                    console.error('ìƒíƒœ ë³€ê²½ ì‹¤íŒ¨:', error);
                    showSyncStatus('error', 'ì €ì¥ ì‹¤íŒ¨');
                    setTimeout(() => hideSyncStatus(), 3000);
                }
            }
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStatistics(checklist) {
            const total = checklist.s.length;
            const counts = { 0: 0, 1: 0, 2: 0, 3: 0, 4: 0 };

            checklist.s.forEach(statusId => {
                counts[statusId]++;
            });

            // ê° ìƒíƒœë³„ ì¹´ìš´íŠ¸ì™€ í¼ì„¼íŠ¸ ì—…ë°ì´íŠ¸
            const statusMapping = {
                0: { countId: 'incompleteCount', percentId: 'incompletePercent', barId: 'incompleteBar' },
                1: { countId: 'completedCount', percentId: 'completedPercent', barId: 'completedBar' },
                2: { countId: 'inProgressCount', percentId: 'inProgressPercent', barId: 'inProgressBar' },
                3: { countId: 'resubmitCount', percentId: 'resubmitPercent', barId: 'resubmitBar' },
                4: { countId: 'deadlineCount', percentId: 'deadlinePercent', barId: 'deadlineBar' }
            };

            Object.entries(counts).forEach(([statusId, count]) => {
                const percent = total > 0 ? ((count / total) * 100).toFixed(1) : '0.0';
                const { countId, percentId, barId } = statusMapping[statusId];
                
                document.getElementById(countId).textContent = count;
                document.getElementById(percentId).textContent = percent;
                document.getElementById(barId).style.width = `${percent}%`;
            });

            // ì™„ë£Œ ìˆœìœ„ í‘œì‹œ
            const completionOrder = checklist.t
                .map((time, index) => ({ index, time }))
                .filter(item => item.time !== null)
                .sort((a, b) => new Date(a.time) - new Date(b.time))
                .slice(0, 5);

            // ê¸°ì¡´ ìˆœìœ„ ì„¹ì…˜ ì œê±°
            const statisticsSection = document.getElementById('statistics');
            const existingRanking = statisticsSection.querySelector('.ranking-section');
            if (existingRanking) {
                existingRanking.remove();
            }

            if (completionOrder.length > 0) {
                const rankingHtml = `
                    <div class="ranking-section mt-4 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                        <h4 class="text-sm font-semibold dark:text-gray-100 mb-2">ğŸ† ì™„ë£Œ ìˆœìœ„ (ìƒìœ„ 5ëª…)</h4>
                        <div class="space-y-1">
                            ${completionOrder.map((item, index) => {
                                const completionTime = new Date(item.time);
                                // í•œêµ­ ì‹œê°„ìœ¼ë¡œ ë³€í™˜
                                const koreanTime = completionTime.toLocaleString('ko-KR', {
                                    timeZone: 'Asia/Seoul',
                                    hour: '2-digit',
                                    minute: '2-digit',
                                    second: '2-digit',
                                    hour12: false
                                });
                                
                                return `
                                <div class="flex items-center justify-between text-sm">
                                    <span class="dark:text-gray-100">
                                        ${index + 1}ìœ„: ${item.index + 1}ë²ˆ
                                    </span>
                                    <span class="text-gray-500 dark:text-gray-400">
                                        ${koreanTime}
                                    </span>
                                </div>
                            `}).join('')}
                        </div>
                    </div>
                `;
                statisticsSection.insertAdjacentHTML('beforeend', rankingHtml);
            }
        }

        // ì²´í¬ë¦¬ìŠ¤íŠ¸ ë‚´ìš© ë Œë”ë§
        function renderChecklistContent(checklist) {
            const contentContainer = document.getElementById('checklistContent');
            
            contentContainer.innerHTML = checklist.s.map((statusId, index) => {
                const status = getStatusById(statusId);
                
                return `
                    <div class="flex flex-col items-center">
                        <span class="text-sm mb-1 dark:text-gray-100">${index + 1}ë²ˆ</span>
                        <button class="status-btn ${status.color} text-white rounded hover:opacity-90 w-full"
                                onclick="changeStatus(${checklist.id}, ${index})">
                            ${status.text}
                        </button>
                    </div>
                `;
            }).join('');
        }

        // ì²´í¬ë¦¬ìŠ¤íŠ¸ ë‚´ë³´ë‚´ê¸° (JSON í˜•íƒœë¡œ)
        function exportChecklists() {
            if (checklists.length === 0) {
                alert('ë‚´ë³´ë‚¼ ì²´í¬ë¦¬ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const now = new Date();
            const dateStr = now.toISOString().slice(0, 19).replace(/[:]/g, '-');
            const fileName = `ì²´í¬ë¦¬ìŠ¤íŠ¸_${dateStr}.json`;
            
            const dataStr = JSON.stringify(checklists, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', fileName);
            linkElement.click();
        }

        // ì²´í¬ë¦¬ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°
        async function importChecklists(event) {
            const file = event.target.files[0];
            if (!file || !supabase) return;

            const reader = new FileReader();
            reader.onload = async function(e) {
                try {
                    const importedChecklists = JSON.parse(e.target.result);
                    
                    if (!Array.isArray(importedChecklists)) {
                        throw new Error('ìœ íš¨í•˜ì§€ ì•Šì€ ì²´í¬ë¦¬ìŠ¤íŠ¸ íŒŒì¼ì…ë‹ˆë‹¤.');
                    }

                    if (confirm('ê¸°ì¡´ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ ëª¨ë‘ ë®ì–´ì“°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                        showSyncStatus('syncing', 'ê°€ì ¸ì˜¤ê¸° ì¤‘...');
                        
                        // ê¸°ì¡´ ë°ì´í„° ì‚­ì œ
                        const { error: deleteError } = await supabase
                            .from('checklists')
                            .delete()
                            .eq('user_id', userId);
                        
                        if (deleteError) throw deleteError;
                        
                        // ìƒˆ ë°ì´í„° ì €ì¥
                        for (const checklist of importedChecklists) {
                            await saveChecklistToSupabase(checklist);
                        }
                        
                        showSyncStatus('success', 'ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ');
                        setTimeout(() => hideSyncStatus(), 2000);
                        
                        // ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
                        await loadChecklists();
                    }
                } catch (error) {
                    console.error('ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
                    alert('íŒŒì¼ ê°€ì ¸ì˜¤ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
                    showSyncStatus('error', 'ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨');
                    setTimeout(() => hideSyncStatus(), 3000);
                }
            };
            reader.readAsText(file);
            
            // íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™”
            event.target.value = '';
        }

        // ë‹¤í¬ëª¨ë“œ í† ê¸€
        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            if (isDarkMode) {
                document.documentElement.classList.add('dark');
                document.getElementById('darkModeIcon').textContent = 'â˜€ï¸';
            } else {
                document.documentElement.classList.remove('dark');
                document.getElementById('darkModeIcon').textContent = 'ğŸŒ™';
            }
            localStorage.setItem(STORAGE_KEYS.DARK_MODE, isDarkMode);
        }

        // ì‹œê³„ ì—…ë°ì´íŠ¸
        function updateClock() {
            const now = new Date();
            document.getElementById('clock').textContent = now.toLocaleTimeString();
        }

        // ì´ˆê¸°í™”
        async function init() {
            // ë‹¤í¬ëª¨ë“œ ì„¤ì •
            if (isDarkMode) {
                document.documentElement.classList.add('dark');
                document.getElementById('darkModeIcon').textContent = 'â˜€ï¸';
            }

            // ì‹œê³„ ì‹œì‘
            updateClock();
            setInterval(updateClock, 1000);

            // ì €ì¥ëœ í•™ìƒ ìˆ˜ ë¶ˆëŸ¬ì˜¤ê¸°
            const savedCount = localStorage.getItem(STORAGE_KEYS.STUDENT_COUNT);
            if (savedCount) {
                document.getElementById('studentCount').value = savedCount;
            }

            // Supabase ì´ˆê¸°í™”
            await initSupabase();
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>